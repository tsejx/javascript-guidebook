---
nav:
  title: BOM
  order: 5
group:
  title: æµè§ˆå™¨å·¥ä½œåŸç†
  order: 20
title: æµè§ˆå™¨äº‹ä»¶å¤„ç†
order: 15
---

# æµè§ˆå™¨äº‹ä»¶å¤„ç†

## è¾“å…¥äº‹ä»¶

å¬åˆ° **è¾“å…¥äº‹ä»¶** è¿™ä¸ªå­—çœ¼ï¼Œä½ è„‘æµ·é‡Œé—ªç°çš„ææ€•åªæ˜¯è¾“å…¥æ–‡æœ¬æˆ–ç‚¹å‡»é¼ æ ‡ã€‚ä½†åœ¨æµè§ˆå™¨çœ¼ä¸­ï¼Œè¾“å…¥æ„å‘³ç€ä¸€åˆ‡ç”¨æˆ·è¡Œä¸ºã€‚ä¸å•æ»šåŠ¨é¼ æ ‡æ»‘è½®æ˜¯è¾“å…¥äº‹ä»¶ï¼Œè§¦æ‘¸å±å¹•ã€æ»‘åŠ¨é¼ æ ‡åŒæ ·ä¹Ÿæ˜¯ç”¨æˆ·è¾“å…¥äº‹ä»¶ã€‚

è¯¸å¦‚è§¦æ‘¸å±å¹•ä¹‹ç±»ç”¨æˆ·æ‰‹åŠ¿äº§ç”Ÿæ—¶ï¼Œæµè§ˆå™¨è¿›ç¨‹ä¼šç‡å…ˆå°†å…¶æ•è·ã€‚ç„¶è€Œæµè§ˆå™¨è¿›ç¨‹æ‰€æŒæ¡çš„ä¿¡æ¯ä»…é™äºè¡Œä¸ºå‘ç”Ÿçš„åŒºåŸŸï¼Œå› ä¸ºæ ‡ç­¾é¡µé‡Œçš„å†…å®¹éƒ½ç”±æ¸²æŸ“è¿›ç¨‹è´Ÿè´£å¤„ç†ï¼Œæ‰€ä»¥æµè§ˆå™¨è¿›ç¨‹ä¼šå°†äº‹ä»¶ç±»å‹ï¼ˆå¦‚ touchstartï¼‰åŠå…¶åæ ‡å‘é€ç»™æ¸²æŸ“è¿›ç¨‹ã€‚æ¸²æŸ“è¿›ç¨‹ä¼šå¯»è‡³äº‹ä»¶ç›®æ ‡ï¼Œè¿è¡Œå…¶äº‹ä»¶ç›‘å¬å™¨ï¼Œå¦¥å–„åœ°å¤„ç†äº‹ä»¶ã€‚

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/input-event-from-browser-to-renderer.png';

export default () => <img alt="è¾“å…¥äº‹ä»¶ç”±æµè§ˆå™¨è¿›ç¨‹å‘å¾€æ¸²æŸ“è¿›ç¨‹" src={img} width={520} />;
```

## åˆæˆå™¨æ¥æ”¶è¾“å…¥äº‹ä»¶

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/input-event-from-browser-to-renderer.png';

export default () => <img alt="æ‚¬äºé¡µé¢å›¾å±‚çš„è§†å›¾çª—å£" src={img} width={520} />;
```

åœ¨ä¸Šç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬æ¢è®¨äº†åˆæˆå™¨å¦‚ä½•é€šè¿‡åˆæˆæ …æ ¼åŒ–å›¾å±‚ï¼Œå®ç°æµç•…çš„é¡µé¢æ»šåŠ¨ã€‚å¦‚æœé¡µé¢ä¸Šæ²¡æœ‰æ·»åŠ ä»»ä½•äº‹ä»¶ç›‘å¬ï¼Œåˆæˆå™¨çº¿ç¨‹ä¼šåˆ›å»ºç‹¬ç«‹äºä¸»çº¿ç¨‹çš„æ–°åˆæˆå¸§ã€‚ä½†è¦æ˜¯é¡µé¢ä¸Šæ·»åŠ äº†äº‹ä»¶ç›‘å¬å‘¢ï¼Ÿåˆæˆå™¨çº¿ç¨‹åˆæ˜¯å¦‚ä½•å¾—çŸ¥äº‹ä»¶æ˜¯å¦éœ€è¦å¤„ç†çš„ï¼Ÿ

## ç†è§£éç«‹å³å¯æ»šåŠ¨åŒº

å› ä¸ºè¿è¡Œ JavaScript è„šæœ¬æ˜¯ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œæ‰€ä»¥é¡µé¢åˆæˆåï¼Œåˆæˆè¿›ç¨‹ä¼šå°†é¡µé¢é‡Œæ·»åŠ äº†äº‹ä»¶ç›‘å¬çš„åŒºåŸŸæ ‡è®°ä¸º **éç«‹å³å¯æ»šåŠ¨åŒº**ã€‚æœ‰äº†è¿™ä¸ªä¿¡æ¯ï¼Œå¦‚æœè¾“å…¥äº‹ä»¶å‘ç”Ÿåœ¨è¿™ä¸€åŒºåŸŸï¼Œåˆæˆè¿›ç¨‹å¯ä»¥ç¡®å®šåº”å°†å…¶å‘å¾€ä¸»çº¿ç¨‹å¤„ç†ã€‚å¦‚è¾“å…¥äº‹ä»¶å‘ç”Ÿåœ¨è¿™ä¸€åŒºåŸŸä¹‹å¤–ï¼Œåˆæˆè¿›ç¨‹åˆ™ç¡®å®šæ— éœ€ç­‰å¾…ä¸»çº¿ç¨‹ï¼Œå¯ç»§ç»­åˆæˆæ–°å¸§ã€‚

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/non-fast-scrollable-region.png';

export default () => <img alt="éç«‹å³å¯æ»šåŠ¨åŒºè¾“å…¥æè¿°ç¤ºæ„å›¾" src={img} width={520} />;
```

### è®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶é¡»æ³¨æ„

Web å¼€å‘ä¸­å¸¸ç”¨çš„äº‹ä»¶å¤„ç†æ¨¡å¼æ˜¯ **äº‹ä»¶ä»£ç†**ã€‚å› ä¸ºäº‹ä»¶ä¼šå†’æ³¡ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨æœ€é¡¶å±‚çš„å…ƒç´ ä¸­æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ï¼Œç”¨æ¥ä»£ç†äº‹ä»¶ç›®æ ‡äº§ç”Ÿçš„ä»»åŠ¡ã€‚ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼Œä½ å¯èƒ½è§è¿‡ï¼Œæˆ–è®¸ä¹Ÿå†™è¿‡ã€‚

```js
document.body.addEventListener('touchstart', (event) => {
  if (event.target === area) {
    event.preventDefault();
  }
});
```

è¿™æ ·åªéœ€æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå³å¯ç›‘å¬æ‰€æœ‰å…ƒç´ ï¼Œçš„ç¡®ååˆ†çœäº‹ã€‚ç„¶è€Œï¼Œå¦‚æœç«™åœ¨æµè§ˆå™¨çš„è§’åº¦å»è€ƒé‡ï¼Œè¿™ç­‰äºæŠŠæ•´ä¸ªé¡µé¢éƒ½æ ‡è®°æˆäº† **éç«‹å³å¯æ»šåŠ¨åŒº**ï¼Œæ„å‘³ç€å³ä¾¿ä½ è®¾è®¡çš„åº”ç”¨æœ¬ä¸å¿…ç†ä¼šé¡µé¢ä¸Šä¸€äº›åŒºåŸŸçš„è¾“å…¥è¡Œä¸ºï¼Œåˆæˆçº¿ç¨‹ä¹Ÿå¿…é¡»åœ¨æ¯æ¬¡è¾“å…¥äº‹ä»¶äº§ç”Ÿåä¸ä¸»çº¿ç¨‹é€šä¿¡å¹¶ç­‰å¾…è¿”å›ã€‚å¦‚æ­¤åˆ™å¾—ä¸å¿å¤±ï¼Œä½¿åŸæœ¬èƒ½ä¿éšœé¡µé¢æ»šåŠ¨æµç•…çš„åˆæˆå™¨æ²¡äº†ç”¨æ­¦ä¹‹åœ°ã€‚

ä½ å¯ä»¥ç»™äº‹ä»¶ç›‘å¬æ·»åŠ ä¸€ä¸ª `passive: true` é€‰é¡¹ ï¼Œå°†è¿™ç§è´Ÿé¢æ•ˆæœæœ€å°åŒ–ã€‚è¿™ä¼šæç¤ºæµè§ˆå™¨ä½ æƒ³ç»§ç»­åœ¨ä¸»çº¿ç¨‹ä¸­ç›‘å¬äº‹ä»¶ï¼Œä½†åˆæˆå™¨ä¸å¿…åœæ»ç­‰å€™ï¼Œå¯æ¥ç€åˆ›å»ºæ–°çš„åˆæˆå¸§ã€‚

```js
document.body.addEventListener(
  'touchstart',
  (event) => {
    if (event.target === area) {
      event.preventDefault();
    }
  },
  {
    passive: true,
  }
);
```

## æ£€æŸ¥äº‹ä»¶æ˜¯å¦å¯æ’¤é”€

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/horizontally-scrollable-website.png';

export default () => <img alt="éƒ¨åˆ†åŒºåŸŸä»…å¯æ°´å¹³æ–¹å‘æ»šåŠ¨çš„ç½‘é¡µ" src={img} width={520} />;
```

è®¾æƒ³ä¸€ä¸‹è¿™ç§æƒ…å½¢ï¼šé¡µé¢ä¸Šæœ‰ä¸€ä¸ªç›’å­ï¼Œä½ è¦å°†å…¶æ»šåŠ¨æ–¹å‘é™åˆ¶ä¸ºæ°´å¹³æ»šåŠ¨ã€‚

ä¸ºç›®æ ‡äº‹ä»¶è®¾ç½® `passive: true` é€‰é¡¹å¯è®©é¡µé¢æ»šåŠ¨å¹³æ»‘ï¼Œä½†åœ¨ä½ ä½¿ç”¨ `preventDefault` ä»¥é™åˆ¶æ»šåŠ¨æ–¹å‘æ—¶ï¼Œå‚ç›´æ–¹å‘æ»šåŠ¨å¯èƒ½å·²ç»è§¦å‘ã€‚ä½¿ç”¨ `event.cancelable` å¯ä»¥æ£€æŸ¥å¹¶é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿã€‚

```js
document.body.addEventListener('pointermove', event => {
  if (event.cancelable) {
    event.preventDefault(); // é˜»æ­¢é»˜è®¤çš„æ»šåŠ¨è¡Œä¸º
    /*
    *  è¿™é‡Œè®¾ç½®ç¨‹åºæ‰§è¡Œä»»åŠ¡
    */
  }
}, {passive:: true});
```

æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥åº”ç”¨ `touch-action` è¿™ç±» CSS è§„åˆ™ï¼Œå®Œå…¨åœ°å°†äº‹ä»¶å¤„ç†å™¨å±è”½æ‰ã€‚

```css
#area {
  touch-action: pan-x;
}
```

## å®šä½äº‹ä»¶ç›®æ ‡

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/main-process-check-paint-record.png';

export default () => <img alt="ä¸»çº¿ç¨‹æ£€æŸ¥ç»˜åˆ¶è®°å½•æŸ¥è¯¢åæ ‡Xå’ŒYå¤„ç»˜åˆ¶å†…å®¹" src={img} width={520} />;
```

åˆæˆå™¨å°†è¾“å…¥äº‹ä»¶å‘é€è‡³ä¸»çº¿ç¨‹åï¼Œé¦–å…ˆè¿è¡Œçš„æ˜¯å‘½ä¸­æ£€æµ‹ã€‚å‘½ä¸­æ£€æµ‹ä¼šä½¿ç”¨æ¸²æŸ“è¿›ç¨‹ä¸­äº§ç”Ÿçš„ç»˜åˆ¶è®°å½•æ•°æ®ï¼Œæ‰¾å‡ºäº‹ä»¶å‘ç”Ÿåæ ‡ä¸‹çš„å†…å®¹ã€‚

## é™ä½å¾€ä¸»çº¿ç¨‹å‘é€äº‹ä»¶çš„é¢‘ç‡

ä¹‹å‰çš„æ–‡ç« é‡Œï¼Œæˆ‘ä»¬æ¢è®¨äº†å¸¸è§æ˜¾ç¤ºå±å¦‚ä½•ä»¥æ¯ç§’ 60 å¸§çš„é¢‘ç‡åˆ·æ–°ï¼Œä»¥åŠæˆ‘ä»¬è¦æ€æ ·ä¸å…¶åˆ·æ–°é¢‘ç‡ä¿æŒæ­¥è°ƒä¸€è‡´ï¼Œä»¥è¥é€ å‡ºæµç•…çš„åŠ¨ç”»æ•ˆæœã€‚è€Œå¯¹äºç”¨æˆ·çš„è¾“å…¥è¡Œä¸ºï¼Œå¸¸è§è§¦æ‘¸å±è®¾å¤‡çš„äº‹ä»¶ä¼ è¾“é¢‘ç‡ä¸ºæ¯ç§’ 60~120 æ¬¡ï¼Œå¸¸è§é¼ æ ‡è®¾å¤‡çš„äº‹ä»¶ä¼ è¾“é¢‘ç‡ä¸ºæ¯ç§’ 100 æ¬¡ã€‚å¯è§ï¼Œè¾“å…¥äº‹ä»¶æœ‰ç€æ¯”æ˜¾ç¤ºå±å¹•æ›´é«˜çš„ä¿çœŸåº¦ã€‚

å¦‚æœä¸€è¿ä¸² `touchmove` è¿™æ ·çš„äº‹ä»¶ä»¥æ¯ç§’ 120 æ¬¡çš„é¢‘ç‡å‘é€å¾€ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šè§¦å‘è¿‡é‡çš„å‘½ä¸­æ£€æµ‹åŠ JavaScript è„šæœ¬æ‰§è¡Œã€‚ç›¸å½¢è€Œè¨€ï¼Œæˆ‘ä»¬çš„å±å¹•åˆ·æ–°ç‡åˆ™ä½ä¸‹å¾—å¤šã€‚

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/massive-event-and-website-flicker.png';

export default () => <img alt="å¤§é‡äº‹ä»¶æ¶Œå…¥åˆæˆå¸§æ—¶é—´è½´ä¼šé€ æˆé¡µé¢é—ªçƒ" src={img} width={640} />;
```

ä¸ºäº†é™ä½å¾€ä¸»çº¿ç¨‹ä¸­ä¼ é€’è¿‡é‡è°ƒç”¨ï¼ŒChrome ä¼šåˆå¹¶è¿™äº›è¿ç»­äº‹ä»¶ï¼ˆå¦‚ï¼š`wheel`ã€`mousewheel`ã€`mousemove`ã€`pointermove`ã€`touchmove` ç­‰ï¼‰ï¼Œå¹¶å°†å…¶å»¶è¿Ÿè‡³ä¸‹ä¸€æ¬¡ `requestAnimationFrame` å‰å‘é€ã€‚

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/same-timeline-composite-event.png';

export default () => <img alt="ç›¸åŒçš„æ—¶é—´è½´ä¸‹äº‹ä»¶è¢«åˆå¹¶ä¸”å»¶è¿Ÿå‘é€" src={img} width={640} />;
```

æ‰€æœ‰ç‹¬ç«‹çš„äº‹ä»¶ï¼Œå¦‚: `keydown`ã€`keyup`ã€`mouseup`ã€`mousedown`ã€`touchstart` åŠ `touchend` åˆ™ä¼šç«‹å³å‘å¾€ä¸»çº¿ç¨‹ã€‚

## å¸§å†…äº‹ä»¶

äº‹ä»¶åˆå¹¶å¯å¸®åŠ©å¤§å¤šæ•° Web åº”ç”¨æ„å»ºè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ç„¶è€Œï¼Œå¦‚æœä½ å¼€å‘çš„æ˜¯ä¸€ä¸ªç»˜å›¾ç±»åº”ç”¨ï¼Œéœ€è¦åŸºäº `touchmove` äº‹ä»¶çš„åæ ‡ç»˜åˆ¶çº¿è·¯ï¼Œé‚£ä¹ˆåœ¨ä½ è¯•å›¾ç”»ä¸‹ä¸€æ ¹å…‰æ»‘çš„çº¿æ¡æ—¶ï¼ŒåŒºé—´å†…çš„ä¸€äº›åæ ‡ç‚¹ä¹Ÿå¯èƒ½ä¼šå› äº‹ä»¶åˆå¹¶è€Œä¸¢å¤±ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ç›®æ ‡äº‹ä»¶çš„ `getCoalescedEvents` æ–¹æ³•è·å–äº‹ä»¶åˆå¹¶åçš„ä¿¡æ¯ã€‚

```jsx | inline
import React from 'react';
import img from '../../assets/browser-working-principle/touch-gesture-and-coalesced-event.png';

export default () => (
  <img alt="å·¦ä¸ºæµç•…çš„è§¦æ‘¸æ‰‹åŠ¿è·¯å¾„ã€å³ä¸ºäº‹ä»¶åˆå¹¶åçš„æœ‰é™è·¯å¾„" src={img} width={520} />
);
```

<br />

```js
window.addEventListener('pointermove', (event) => {
  const events = event.getCoalescedEvents();
  for (let event of events) {
    const x = event.pageX;
    const y = event.pageY;
    // ä½¿ç”¨ xã€y åæ ‡ç”»çº¿
  }
});
```

## å‚è€ƒèµ„æ–™

- [ğŸ“ è‹±è¯­åŸæ–‡ï¼šInside look at modern web browserï¼ˆPart 4ï¼‰](https://developers.google.com/web/updates/2018/09/inside-browser-part4)
- [ğŸ“ ç°ä»£æµè§ˆå™¨å†…éƒ¨æ­ç§˜ï¼ˆPart 4ï¼‰](https://juejin.im/post/6844903695600058375)
