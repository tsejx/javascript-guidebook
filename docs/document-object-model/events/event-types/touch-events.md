---
nav:
  title: DOM
  order: 6
group:
  title: äº‹ä»¶ç±»å‹
  order: 21
title: è§¦æ§äº‹ä»¶
order: 50
---

# è§¦æ§äº‹ä»¶

TouchEvent æ˜¯ä¸€ç±»æè¿°æ‰‹æŒ‡åœ¨è§¦æ‘¸å¹³é¢ï¼ˆè§¦æ‘¸å±ã€è§¦æ‘¸æ¿ç­‰ï¼‰çš„çŠ¶æ€å˜åŒ–çš„äº‹ä»¶ã€‚è¿™ç±»äº‹ä»¶ç”¨äºæè¿°ä¸€ä¸ªæˆ–å¤šä¸ªè§¦ç‚¹ï¼Œä½¿å¼€å‘è€…å¯ä»¥æ£€æµ‹è§¦ç‚¹çš„ç§»åŠ¨ï¼Œè§¦ç‚¹çš„å¢åŠ å’Œå‡å°‘ç­‰ç­‰ã€‚

æ¯ä¸ª Touch å¯¹è±¡ä»£è¡¨ä¸€ä¸ªè§¦ç‚¹ï¼Œæ¯ä¸ªè§¦ç‚¹éƒ½ç”±å…¶ä½ç½®ã€å¤§å°ã€å½¢çŠ¶ã€å‹åŠ›å¤§å°å’Œç›®æ ‡å…ƒç´ æè¿°ã€‚TouchList å¯¹è±¡ä»£è¡¨å¤šä¸ªè§¦ç‚¹çš„ä¸€ä¸ªåˆ—è¡¨ã€‚

è§¦æ§äº‹ä»¶ä¸é¼ æ ‡äº‹ä»¶ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯è§¦æ§äº‹ä»¶è¿˜æä¾›åŒä¸€è¡¨é¢ä¸åŒä½ç½®çš„åŒæ­¥è§¦æ‘¸ã€‚

## å®šä¹‰

- è¡¨é¢ï¼ˆSurfaceï¼‰ï¼šå¯æ„ŸçŸ¥è§¦æ‘¸çš„å¹³é¢ï¼Œå¯ä»¥æ˜¯å±å¹•æˆ–è§¦æ§æ¿ã€‚
- è§¦æ‘¸ç‚¹ï¼ˆTouch Pointï¼‰ï¼šè¡¨é¢ä¸Šçš„ä¸€ä¸ªæ¥è§¦ç‚¹ï¼Œæœ‰å¯èƒ½æ˜¯æ‰‹æŒ‡ï¼ˆæˆ–è€…èƒ³è†Šè‚˜ã€è€³æœµã€é¼»å­éƒ½è¡Œã€‚ä½†ä¸€èˆ¬æ˜¯æ‰‹æŒ‡ï¼‰æˆ–è€…è§¦æ‘¸ç¬”

## æ¥å£

è§¦æ§äº‹ä»¶åŒ…æ‹¬ä¸‰ä¸ªæ¥å£å¯¹è±¡ï¼š

- [TouchEvent](https://developer.mozilla.org/zh-CN/docs/Web/API/TouchEvent)ï¼šè¡¨ç¤ºä½äºè¡¨é¢ä¸Šçš„ä¸€ä¸ªè§¦æ‘¸ç‚¹çš„æŸä¸ªçŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶äº§ç”Ÿçš„äº‹ä»¶
- [Touch](https://developer.mozilla.org/zh-CN/docs/Web/API/Touch)ï¼šè¡¨ç¤ºç”¨æˆ·ä¸è§¦æ‘¸è¡¨é¢é—´çš„ä¸€ä¸ªå•ç‹¬çš„æ¥è§¦ç‚¹
- [TouchList](https://developer.mozilla.org/zh-CN/docs/Web/API/TouchList)ï¼šè¡¨ç¤ºä¸€ç»„ Touchï¼Œç”¨äºå¤šç‚¹è§¦æ§çš„æƒ…å†µ

TouchEvent çš„å±æ€§ç»§æ‰¿äº† UIEvent å’Œ Eventã€‚[è¯¦æƒ…è§ MDN æ–‡æ¡£](https://developer.mozilla.org/zh-CN/docs/Web/API/TouchEvent#%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8)

é€šè¿‡æ£€æŸ¥è§¦æ§äº‹ä»¶çš„ `TouchEvent.type` å±æ€§æ¥ç¡®å®šå½“å‰äº‹ä»¶å±äºå“ªç§ç±»å‹ã€‚

> âš ï¸ æ³¨æ„ï¼šåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè§¦æ§äº‹ä»¶å’Œé¼ æ ‡äº‹ä»¶ä¼šåŒæ—¶è§¦å‘ï¼ˆç›®çš„æ˜¯è®©æ²¡æœ‰å¯¹è§¦æ§è®¾å¤‡ä¼˜åŒ–çš„ä»£ç ä»å¯åœ¨è§¦æ§è®¾å¤‡ä¸Šè¿è¡Œï¼‰ã€‚å¦‚æœä½ è°ƒç”¨äº†è§¦æ§äº‹ä»¶ï¼Œå¯ä»¥é˜»æ­¢é»˜è®¤è¡Œä¸ºä»¥é˜²æ­¢è§¦å‘ç›¸å¯¹åº”çš„é¼ æ ‡äº‹ä»¶ã€‚

## è§¦æ§äº‹ä»¶ç±»å‹

ä¸ºäº†åŒºåˆ«è§¦æ§ç›¸å…³çš„çŠ¶æ€æ”¹å˜ï¼Œå­˜åœ¨å¤šç§ç±»å‹çš„è§¦æ§äº‹ä»¶ã€‚å¯ä»¥é€šè¿‡æ£€æŸ¥è§¦æ§äº‹ä»¶çš„ `TouchEvent.type` å±æ€§æ¥ç¡®å®šå½“å‰äº‹ä»¶å±äºå“ªç§ç±»å‹ã€‚

| äº‹ä»¶        | è¯´æ˜                                                             |
| :---------- | :--------------------------------------------------------------- |
| touchstart  | å½“ç”¨æˆ·è§¦æ‘¸å±å¹•æ—¶è§¦å‘ï¼ˆå³ä½¿å·²ç»æœ‰æ‰‹æŒ‡æ”¾åœ¨å±å¹•ä¸Šä¹Ÿä¼šè§¦å‘ï¼‰         |
| touchmove   | å½“æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨æ—¶è§¦å‘ï¼ˆåœ¨è§¦å‘æœŸé—´é˜»æ­¢é»˜è®¤è¡Œä¸ºå¯é˜»æ­¢ç”»é¢æ»‘åŠ¨ï¼‰ |
| touchend    | å½“æ‰‹æŒ‡ä»å±å¹•ä¸Šç¦»å¼€çš„æ—¶å€™è§¦å‘ï¼ˆè§¦å‘é¢‘ç‡å› ä¸åŒæµè§ˆå™¨è€Œä¸åŒï¼‰       |
| touchcancel | å½“ç³»ç»Ÿåœæ­¢è·Ÿè¸ªè§¦æ‘¸çš„æ—¶å€™è§¦å‘ï¼ˆå–å†³äºæµè§ˆå™¨å®ç°ï¼Œå¹¶ä¸å¸¸ç”¨ï¼‰       |

è§¦æ‘¸å±äº‹ä»¶è§¦å‘é¡ºåºï¼š

```
touchstart -> touchmove -> touchend -> click
```

`touchcancel` äº‹ä»¶è§¦å‘çš„å¸¸è§åŸå› ï¼š

- ç”±äºæŸäº‹ä»¶å–æ¶ˆäº†è§¦æ‘¸ï¼šä¾‹å¦‚è§¦æ‘¸è¿‡ç¨‹è¢« Modal æ¨¡æ€æ¡†æ‰“æ–­
- è§¦ç”µç¦»å¼€äº†æ–‡æ¡£çª—å£ï¼Œè€Œè¿›å…¥äº†æµè§ˆå™¨çš„ç•Œé¢å…ƒç´ ã€æ’ä»¶æˆ–è€…å…¶ä»–å¤–éƒ¨å†…å®¹åŒºåŸŸ
- å½“ç”¨æˆ·äº§ç”Ÿçš„è§¦ç‚¹ä¸ªæ•°è¶…è¿‡è®¾å¤‡æ”¯æŒçš„ä¸ªæ•°ï¼Œä»è€Œå¯¼è‡´ TouchList ä¸­æœ€æ—©çš„ Touch å¯¹è±¡è¢«å–æ¶ˆ

å¾ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè§¦æ‘¸äº‹ä»¶å’Œé¼ æ ‡äº‹ä»¶ä¼šä¸€èµ·è§¦å‘ï¼ˆä»¥ä½¿éè§¦æ‘¸ä¸“ç”¨çš„ä»£ç ä»ç„¶å¯ä»¥ä¸ç”¨æˆ·äº¤äº’ï¼‰ã€‚å¦‚æœä½ è¦ä½¿ç”¨è§¦æ‘¸äº‹ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ `preventDefault()` æ¥å–æ¶ˆé¼ æ ‡äº‹ä»¶ã€‚

## æ¥å£å¯¹è±¡

TouchEvent å¯¹è±¡ï¼š

- `touches`ï¼šè§¦å‘äº‹ä»¶æ—¶å±å¹•ä¸Šçš„è§¦ç‚¹ä¸ªæ•°
- `targetTouches`ï¼šè§¦å‘äº‹ä»¶æ—¶äº‹ä»¶å…ƒç´ ä¸Šçš„è§¦ç‚¹ä¸ªæ•°
- `changedTouches`ï¼šè§¦å‘äº‹ä»¶å‘ç”Ÿæ”¹å˜çš„è§¦ç‚¹ä¸ªæ•°
- `target`ï¼šäº‹ä»¶å…ƒç´ 
- `stopPropagation`ï¼šé˜»æ­¢äº‹ä»¶å†’æ³¡
- `preventDefault`ï¼šé˜»æ­¢é»˜è®¤è¡Œä¸º

Touch å¯¹è±¡ï¼š

- `clientX/clientY`ï¼šè§¦ç‚¹åœ¨è§†å£ä¸Šçš„ä½ç½®
- `pageX/pageY`ï¼šè§¦ç‚¹åœ¨é¡µé¢ä¸Šçš„ä½ç½®
- `screenX/screenY`ï¼šè§¦ç‚¹åœ¨å±å¹•ä¸Šçš„ä½ç½®

Touch å¯¹è±¡è¡¨ç¤ºåœ¨è§¦æ§è®¾å¤‡ä¸Šçš„è§¦æ‘¸ç‚¹ã€‚é€šå¸¸æ˜¯æŒ‡æ‰‹æŒ‡æˆ–è€…è§¦æ§ç¬”åœ¨è§¦å±è®¾å¤‡æˆ–è€…è§¦æ‘¸æ¿ä¸Šçš„æ“ä½œã€‚

ä»¥ä¸‹å±æ€§æè¿°äº†ç”¨æˆ·çš„è§¦æ§è¡Œä¸ºï¼ˆå‡ä¸ºåªè¯»å±æ€§ï¼‰ï¼š

| å±æ€§          | è¯´æ˜                                                                                                                               |
| ------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| identifier    | Touch å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸€ä¸ªå®Œæ•´çš„è§¦æ§è¿‡ç¨‹ï¼ˆæ‰‹æŒ‡åœ¨è§¦æ§é¢ä¸Šåˆ’è¿‡æ²¡æœ‰ç¦»å¼€ï¼‰æ ‡è¯†ç¬¦ä¸ä¼šæ”¹å˜ã€‚å¯é€šè¿‡æ­¤å±æ€§åˆ¤æ–­è·Ÿè¸ªæ˜¯å¦æ˜¯åŒä¸€æ¬¡è§¦æ‘¸è¿‡ç¨‹ã€‚ |
| screenX       | è§¦æ§ç‚¹ç›¸å¯¹äºå±å¹•å·¦è¾¹æ²¿çš„ X åæ ‡ã€‚                                                                                                  |
| screenY       | è§¦æ§ç‚¹ç›¸å¯¹äºå±å¹•ä¸Šè¾¹æ²¿çš„ Y åæ ‡ã€‚                                                                                                  |
| clientX       | è§¦æ§ç‚¹ç›¸å¯¹äºå¯è§†åŒºå·¦è¾¹æ²¿çš„ X åæ ‡ï¼Œä¸åŒ…æ‹¬ä»»ä½•æ»šåŠ¨åç§»ã€‚                                                                            |
| clientY       | è§¦æ§ç‚¹ç›¸å¯¹äºå¯è§†åŒºå·¦è¾¹æ²¿çš„ Y åæ ‡ï¼Œä¸åŒ…æ‹¬ä»»ä½•æ»šåŠ¨åç§»ã€‚                                                                            |
| pageX         | è§¦æ§ç‚¹ç›¸å¯¹äºé¡µé¢æ–‡æ¡£å·¦è¾¹æ²¿çš„ X åæ ‡ã€‚                                                                                              |
| pageY         | è§¦æ§ç‚¹ç›¸å¯¹äºé¡µé¢æ–‡æ¡£ä¸Šè¾¹æ²¿çš„ Y åæ ‡ã€‚                                                                                              |
| radiusX       | èƒ½å¤ŸåŒ…å›´ç”¨æˆ·å’Œè§¦æ‘¸å¹³é¢çš„æ¥è§¦é¢çš„æœ€å°æ¤­åœ†çš„æ°´å¹³è½´ï¼ˆX è½´ï¼‰åŠå¾„ã€‚è¿™ä¸ªå€¼çš„å•ä½å’Œ screenX ç›¸åŒã€‚                                        |
| radiusY       | èƒ½å¤ŸåŒ…å›´ç”¨æˆ·å’Œè§¦æ‘¸å¹³é¢çš„æ¥è§¦é¢çš„æœ€å°æ¤­åœ†çš„å‚ç›´è½´ï¼ˆY è½´ï¼‰åŠå¾„ã€‚è¿™ä¸ªå€¼çš„å•ä½å’Œ Â screenY ç›¸åŒ                                         |
| rotationAngle | ç”± radiusX å’Œ radiusY æè¿°çš„æ­£æ–¹å‘æ¤­åœ†ï¼Œéœ€è¦é€šè¿‡é¡ºæ—¶é’ˆæ—‹è½¬è¿™ä¸ªè§’åº¦å€¼ï¼Œæ‰èƒ½æœ€ç²¾å‡†åœ°è¦†ç›–ä½ç”¨æˆ·å’Œè§¦æ§é¢çš„æ¥è§¦é¢ã€‚                     |
| force         | æ‰‹æŒ‡æŒ¤å‹è§¦æ§å¹³é¢çš„å‹åŠ›å¤§å°ï¼Œå–å€¼èŒƒå›´ 0.0 åˆ° 1.0 çš„æµ®ç‚¹æ•°ï¼ˆæ²¡æœ‰å‹åŠ›åˆ°æœ€å¤§å‹åŠ›ï¼‰                                                     |

## åº”ç”¨å®ä¾‹

### æ‰‹åŠ¿äº‹ä»¶

ç§»åŠ¨ç«¯æ‰‹åŠ¿äº‹ä»¶ï¼ˆå¤šæŒ‡äº‹ä»¶ï¼‰

```js
(function(w) {
  function gesture(node, callback) {
    // æ‰‹åŠ¿å¼€å§‹
    node.addEventListener('touchstart', function(event) {
      // å½“è§¦æ‘¸å…ƒç´ æ—¶ï¼Œåˆ¤æ–­å±å¹•ä¸Šè§¦æ‘¸å±å¹•çš„æ‰‹æŒ‡ä¸ªæ•°
      if (event.touches.length >= 2) {
        // æ ‡è®°å·²ç»è§¦å‘äº†æ‰‹åŠ¿å¼€å§‹
        node.isGestureStart = true;
        // è®¡ç®—ä¸¤ä¸ªè§¦ç‚¹çš„åˆå§‹è·ç¦»
        this.startDistance = calcDistance(event.touches[0], event.touches[1]);
        // è®¡ç®—ä¸¤ä¸ªè§¦ç‚¹çš„åˆå§‹è§’åº¦
        this.startDegree = calcDegree(event.touches[0], event.touches[1]);
        // è°ƒç”¨å›è°ƒå‡½æ•°
        if (callback && typeof callback['start'] === 'function') {
          callback['start']();
        }
      }
    });

    // æ‰‹åŠ¿ç§»åŠ¨
    node.addEventListener('touchmove', function(event) {
      if (event.touches.length >= 2) {
        // è®¡ç®—å½“å‰ä¸¤ä¸ªè§¦ç‚¹çš„è·ç¦»
        const currentDistance = calcDistance(event.touches[0], event.touches[1])
        // è®¡ç®—å½“å‰ä¸¤ä¸ªè§¦ç‚¹çš„è·ç¦»
        const currentDegree = calcDegree(event.touches[0], event.touches[1])
        // è®¡ç®—å½“å‰ä¸¤ä¸ªè§¦ç‚¹çš„è·ç¦»å’Œä¸¤ä¸ªè§¦ç‚¹çš„åˆå§‹è·ç¦»æ¯”ä¾‹
        event.scale = currentDistance / this.startDistance
        // è®¡ç®—ä¸¤ä¸ªè§¦ç‚¹ï¼Œå¤¹è§’çš„å˜åŒ–
        event.rotation = currentDistance - this.startDegree
        // è°ƒç”¨å›è°ƒå‡½æ•°
        if (callback && typeof(callback['change']) === 'function') {
          callback['change'](event)
        }
      }
    })

    // æ‰‹åŠ¿ç»“æŸ
    // è§¦å‘è¿‡æ‰‹åŠ¿å¼€å§‹å¹¶ä¸”æœ‰è§¦æ‘¸ç»“æŸçš„æ—¶å€™åˆ¤æ–­å±å¹•ä¸Šæ‰‹æŒ‡æ•°é‡ < 2
    node.addEventListener('touchend' function(event) {
      if (node.isGestureStart && event.touches.length < 2) {
        // é‡ç½®æ ‡è®°
        node.isGestureStart = false;
        // è°ƒç”¨å›è°ƒå‡½æ•°
        if (callback && typeof(callback['end']) === 'function') {
          callback['end']
        }
      }
    })


    function calcDistance(touch1, touch2) {
      // è®¡ç®—ä¸¤ä¸ªç›´è§’è¾¹çš„é•¿åº¦
      // æ°´å¹³æ–¹å‘çš„è·ç¦»
      const x = touch2.clientX - touch1.clientX;
      // å‚ç›´æ–¹å‘çš„è·ç¦»
      const y = touch2.clientY - touch2.clientY;
      // åˆ©ç”¨å‹¾è‚¡å®šåŠ›ï¼Œè®¡ç®—ä¸¤ä¸ªè§¦ç‚¹çš„è·ç¦»ï¼ˆæ–œè¾¹çš„é•¿åº¦ï¼‰
      const z = Math.sqrt(x * x + y * y);

      return z;
    }

    function calcDegree(touch1, touch2) {
      // è®¡ç®—ä¸¤ä¸ªè§¦ç‚¹çš„è·ç¦»ï¼Œä¸¤ä¸ªç›´è§’è¾¹é•¿åº¦
      const x = touch2.clientX - touch1.clientX;
      const y = touch2.clientY - touch1.clientY;
      // æ ¹æ®ä¸¤ä¸ªç›´è§’è¾¹æ¯”ä¾‹ tanï¼Œè®¡ç®—è§’åº¦
      const angle = Math.atan2(y, x); // æ˜¯ä¸ªå¼§åº¦
      // æ ¹æ®å¼§åº¦è®¡ç®—è§’åº¦
      const deg = (angle / Math.PI) * 180;

      return deg;
    }
  }

  w.gesture = gesture;
})();
```

### ç§»åŠ¨ç«¯å»¶è¿Ÿé—®é¢˜

ç§»åŠ¨ç«¯ `click` äº‹ä»¶æœ‰ 300ms å»¶è¿Ÿé—®é¢˜ï¼Œ`touch` äº‹ä»¶æ²¡æœ‰ã€‚

ç›®å‰æœ€å¹¿æ³›ä½¿ç”¨çš„è§£å†³ç§»åŠ¨ç«¯ `click` å»¶è¿Ÿé—®é¢˜çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ `fastclick`ã€‚

fastclick çš„æ€è·¯å°±æ˜¯åˆ©ç”¨ touch æ¥æ¨¡æ‹Ÿ tapï¼ˆè§¦ç¢°ï¼‰ï¼Œå¦‚æœè®¤ä¸ºæ˜¯ä¸€æ¬¡æœ‰æ•ˆçš„ tapï¼Œåˆ™åœ¨ touchend æ—¶ç«‹å³æ¨¡æ‹Ÿä¸€ä¸ª click äº‹ä»¶ï¼Œåˆ†å‘åˆ°äº‹ä»¶æºï¼ˆç›¸å½“äºä¸»åŠ¨è§¦å‘ä¸€æ¬¡ `click` äº‹ä»¶ï¼‰ï¼ŒåŒæ—¶é˜»æ­¢æ‰æµè§ˆå™¨ 300ms åäº§ç”Ÿçš„ `click` äº‹ä»¶ã€‚

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ“– MDNï¼šTouchEvent](https://developer.mozilla.org/zh-CN/docs/Web/API/TouchEvent)
- [ğŸ“– W3Cï¼šTouchEvent](https://www.w3.org/TR/touch-events/#touchevent-interface)
