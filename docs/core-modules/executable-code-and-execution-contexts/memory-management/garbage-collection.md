---
nav:
  title: æ ¸å¿ƒæ¨¡å—
  order: 3
group:
  title: å†…å­˜ç®¡ç†
  order: 4
title: åƒåœ¾å›æ”¶
order: 3
---

# åƒåœ¾å›æ”¶

> ç”±äºå­—ç¬¦ä¸²ã€å¯¹è±¡å’Œæ•°ç»„æ²¡æœ‰å›ºå®šå¤§å°ï¼Œæ‰€ä»¥å½“ä»–ä»¬çš„å¤§å°å·²çŸ¥æ—¶ï¼Œæ‰èƒ½å¯¹ä»–ä»¬è¿›è¡ŒåŠ¨æ€çš„å­˜å‚¨åˆ†é…ã€‚JavaScript åºæ¯æ¬¡åˆ›å»ºå­—ç¬¦ä¸²ã€æ•°ç»„æˆ–å¯¹è±¡æ—¶ï¼Œè§£é‡Šå™¨éƒ½å¿…é¡»åˆ†é…å†…å­˜æ¥å­˜å‚¨é‚£ä¸ªå®ä½“ã€‚åªè¦åƒè¿™æ ·åŠ¨æ€åœ°åˆ†é…äº†å†…å­˜ï¼Œæœ€ç»ˆéƒ½è¦é‡Šæ”¾è¿™äº›å†…å­˜ä»¥ä¾¿ä»–ä»¬èƒ½å¤Ÿè¢«å†ç”¨ï¼Œå¦åˆ™ï¼ŒJavaScript çš„è§£é‡Šå™¨å°†ä¼šæ¶ˆè€—å®Œç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„å†…å­˜ï¼Œé€ æˆç³»ç»Ÿå´©æºƒã€‚â€”â€”ã€ŠJavaScript æƒå¨æŒ‡å—ã€‹

åœ¨ C å’Œ C++ ä¹‹ç±»çš„è¯­è¨€ä¸­ï¼Œéœ€è¦æ‰‹åŠ¨æ¥ç®¡ç†å†…å­˜çš„ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆè®¸å¤šä¸å¿…è¦é—®é¢˜çš„æ ¹æºã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨ç¼–å†™ JavaScript çš„è¿‡ç¨‹ä¸­ï¼Œå†…å­˜çš„åˆ†é…ä»¥åŠå†…å­˜çš„å›æ”¶å®Œå…¨å®ç°äº†è‡ªåŠ¨ç®¡ç†ã€‚

JavaScript é€šè¿‡ **è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶** å®ç°å†…å­˜çš„ç®¡ç†ã€‚åƒåœ¾å›æ”¶æœºåˆ¶é€šè¿‡åƒåœ¾æ”¶é›†å™¨æ¯éš”å›ºå®šçš„æ—¶é—´æ®µï¼ˆå‘¨æœŸæ€§ï¼‰æ‰¾å‡ºé‚£äº›ä¸å†éœ€è¦ç»§ç»­ä½¿ç”¨çš„å˜é‡ï¼Œæ‰§è¡Œä¸€æ¬¡é‡Šæ”¾å ç”¨å†…å­˜çš„æ“ä½œã€‚

> ä»€ä¹ˆæ˜¯ä¸å†éœ€è¦ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Ÿ

ä¸å†éœ€è¦ç»§ç»­ä½¿ç”¨çš„å˜é‡ä¹Ÿå°±æ˜¯ç”Ÿå‘½å‘¨æœŸç»“æŸçš„å˜é‡ã€‚

- **å±€éƒ¨å˜é‡**ï¼šåœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­ï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå±€éƒ¨å˜é‡ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼ˆé™¤äº†é—­åŒ…ï¼‰ï¼Œå› æ­¤åƒåœ¾æ”¶é›†å™¨å¾ˆå®¹æ˜“åšå‡ºåˆ¤æ–­å¹¶å›æ”¶
- **å…¨å±€å˜é‡**ï¼šä½†æ˜¯å…¨å±€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸç›´åˆ°æµè§ˆå™¨å¸è½½é¡µé¢æ‰ä¼šç»“æŸï¼Œä¹Ÿå°±æ˜¯**å…¨å±€å˜é‡ä¸ä¼šè¢«å½“æˆåƒåœ¾å˜é‡å›æ”¶**ã€‚æ‰€ä»¥å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€å®šè¦æ…é‡çš„è€ƒè™‘ï¼Œåœ¨ä½¿ç”¨å®Œè¿™ä¸ªå˜é‡çš„å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜åœ¨éœ€è¦è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœä¸éœ€è¦çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥æ‰‹åŠ¨çš„å°†è¿™ä¸ªå˜é‡ç½®ä¸ºç©ºï¼ˆ`null`ï¼‰ï¼Œè¿™æ ·åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå°±èƒ½å»é‡Šæ”¾è¿™ä¸ªå˜é‡ä¸Šä¸€æ¬¡æŒ‡å‘çš„å€¼

## åŸç†

JavaScript æœ‰ä¸¤ç§ç­–ç•¥å®ç°åƒåœ¾å›æ”¶æœºåˆ¶ï¼š

- [æ ‡è®°æ¸…é™¤æ³•](#æ ‡è®°æ¸…é™¤æ³•)
- [å¼•ç”¨è®¡æ•°æ³•](#å¼•ç”¨è®¡æ•°æ³•)

### æ ‡è®°æ¸…é™¤æ³•

**æ ‡è®°æ¸…é™¤æ³•**ï¼šå½“ç¨‹åºæ‰§è¡Œæµå…¥åˆ°ä¸€ä¸ªå‡½æ•°ä¸­æ—¶ï¼Œä¼šåˆ›å»ºè¯¥å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡éƒ½ä¼šè¢«æ ‡è®°ä¸º **è¿›å…¥ç¯å¢ƒ**ï¼Œä»é€»è¾‘ä¸Šè®²ï¼Œæ°¸è¿œä¸èƒ½é‡Šæ”¾ **è¿›å…¥æ‰§è¡Œç¯å¢ƒ** å˜é‡æ‰€å ç”¨çš„å†…å­˜ã€‚å› ä¸ºåªè¦æ‰§è¡Œæµè¿›å…¥ç›¸åº”çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå°±å¯èƒ½ä¼šç”¨åˆ°è¿™äº›å˜é‡ã€‚

æ ‡è®°æ¸…é™¤çš„å·¥ä½œæµç¨‹ï¼š

- åƒåœ¾æ”¶é›†å™¨åœ¨è¿è¡Œçš„æ—¶å€™ä¼šç»™å­˜å‚¨åœ¨å†…å­˜çš„ä¸­çš„ **æ‰€æœ‰å˜é‡éƒ½åŠ ä¸Šæ ‡è®°**
- å»æ‰ **æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡** ä»¥åŠ **è¢«ç¯å¢ƒä¸­çš„å˜é‡å¼•ç”¨çš„å˜é‡** çš„æ ‡è®°
- é‚£äº› **è¿˜å­˜åœ¨æ ‡è®°çš„å˜é‡å°†è¢«è§†ä¸ºå‡†å¤‡åˆ é™¤çš„å˜é‡**
- æœ€ååƒåœ¾æ”¶é›†å™¨å®Œæˆå†…å­˜æ¸…é™¤å·¥ä½œï¼Œé”€æ¯é‚£äº›å¸¦æ ‡è®°çš„å€¼å¹¶å›æ”¶å®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´

æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼š

```js
let a = 1;

a = null;
```

`a = null` å…¶å®ä»…ä»…åªæ˜¯åšäº†ä¸€ä¸ªé‡Šæ”¾å¼•ç”¨çš„æ“ä½œï¼Œè®©å˜é‡ `a` åŸæœ¬å¯¹åº”çš„å€¼å¤±å»å¼•ç”¨ï¼Œè„±ç¦»æ‰§è¡Œç¯å¢ƒï¼Œè¿™ä¸ªå€¼ä¼šåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å™¨æ‰§è¡Œæ“ä½œæ—¶è¢«æ‰¾åˆ°å¹¶é‡Šæ”¾ã€‚è€Œåœ¨é€‚å½“çš„æ—¶å€™è§£é™¤å¼•ç”¨ï¼Œæ˜¯ä¸ºé¡µé¢è·å¾—æ›´å¥½æ€§èƒ½çš„ä¸€ä¸ªé‡è¦æ–¹å¼ã€‚

### å¼•ç”¨è®¡æ•°æ³•

**å¼•ç”¨è®¡æ•°æ³•ï¼š** è·Ÿè¸ªè®°å½•æ¯ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œå½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹èµ‹å€¼ç»™è¯¥å˜é‡æ—¶ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯ `1`ï¼Œå¦‚æœè¿™ä¸ªå€¼å†è¢«èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œåˆ™å¼•ç”¨æ¬¡æ•°åŠ  `1`ã€‚ç›¸åï¼Œå¦‚æœåŒ…å«å¯¹è¿™ä¸ªå€¼å¼•ç”¨çš„å˜é‡åˆå–å¾—äº†å¦å¤–ä¸€ä¸ªå€¼ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±å‡ `1`ã€‚å½“è¿™ä¸ªå¼•ç”¨æ¬¡æ•°å˜æˆ `0` æ—¶ï¼Œåˆ™è¯´æ˜æ²¡æœ‰åŠæ³•å†è®¿é—®è¿™ä¸ªå€¼äº†ï¼Œå› è€Œå°±å¯ä»¥å°†å…¶æ‰€å çš„å†…å­˜ç©ºé—´ç»™æ”¶å›æ¥ã€‚è¿™æ ·ï¼Œåƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡å†è¿è¡Œæ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾é‚£äº›å¼•ç”¨æ¬¡æ•°ä¸º `0` çš„å€¼æ‰€å çš„å†…å­˜ã€‚

è¿™ç§åƒåœ¾æ”¶é›†æ–¹å¼å­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜å°±æ˜¯å¾ªç¯å¼•ç”¨ï¼Œå°±æ˜¯è¯´å¯¹è±¡ `a` åŒ…å«ä¸€ä¸ªæŒ‡å‘ `b` çš„æŒ‡é’ˆï¼Œå¯¹è±¡ `b` ä¹ŸåŒ…å«ä¸€ä¸ªæŒ‡å‘ `a` çš„å¼•ç”¨ã€‚ è¿™å°±å¯èƒ½é€ æˆå¤§é‡å†…å­˜å¾—ä¸åˆ°å›æ”¶ï¼Œä¹Ÿå°±æ˜¯å†…å­˜æ³„æ¼ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬çš„å¼•ç”¨æ¬¡æ•°æ°¸è¿œä¸å¯èƒ½æ˜¯ `0`ã€‚

ğŸŒ° **ä»£ç ç¤ºä¾‹**ï¼š

```js
function problem() {
  var a = new Object();
  var b = new Object();
  a.ref = b;
  b.ref = a;
}
```

## å †æ ˆæº¢å‡º

**å †æ ˆæº¢å‡º**ï¼šæŒ‡å†…å­˜ç©ºé—´å·²ç»è¢«ç”³è¯·å®Œï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æä¾›äº†ã€‚

## å†…å­˜æ³„æ¼

**å†…å­˜æ³„æ¼**ï¼šæŒ‡ç”³è¯·çš„å†…å­˜æ‰§è¡Œå®Œåæ²¡æœ‰åŠæ—¶çš„æ¸…ç†æˆ–è€…é”€æ¯ï¼Œå ç”¨ç©ºé—²å†…å­˜ï¼Œå†…å­˜æ³„æ¼è¿‡å¤šçš„è¯ï¼Œå°±ä¼šå¯¼è‡´åé¢çš„è¿›ç¨‹ç”³è¯·ä¸åˆ°å†…å­˜ã€‚å› æ­¤å†…å­˜æ³„æ¼ä¼šå¯¼è‡´å†…éƒ¨å†…å­˜æº¢å‡ºã€‚

```plain
å†…å­˜æ³„æ¼ --å¯èƒ½å¯¼è‡´--> å †æ ˆæº¢å‡º
```

åœ¨ä¼ ç»Ÿçš„ç¼–ç¨‹è½¯ä»¶ä¸­ï¼Œæ¯”å¦‚ C è¯­è¨€ä¸­ï¼Œéœ€è¦ä½¿ç”¨ `malloc` æ¥ç”³è¯·å†…å­˜ç©ºé—´ï¼Œå†ä½¿ç”¨ `free` æ¥é‡Šæ”¾æ‰ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…é™¤ã€‚è€Œ JavaScript ä¸­æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¸€èˆ¬å¸¸ç”¨çš„åƒåœ¾æ”¶é›†æ–¹æ³•å°±æ˜¯æ ‡è®°æ¸…é™¤æ³•ã€‚

- å³ä½¿ 1Byte çš„å†…å­˜ï¼Œä¹Ÿå«å†…å­˜æ³„æ¼ï¼Œå¹¶ä¸ä¸€å®šæ˜¯å¯¼è‡´æµè§ˆå™¨å¥”æºƒã€å¡é¡¿æ‰èƒ½å«å†…å­˜æ³„æ¼
- ä¸€èˆ¬æ˜¯å †åŒºå†…å­˜æ³„æ¼ï¼Œæ ˆåŒºä¸ä¼šæ³„æ¼ã€‚åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ä¿å­˜åœ¨æ ˆä¸­ï¼Œå¼•ç”¨æ•°æ®ç±»å‹ä¿å­˜åœ¨å †ä¸­ã€‚æ‰€ä»¥å¯¹è±¡ã€æ•°ç»„ç­‰æ‰ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚

**å¸¸è§çš„å†…å­˜æ³„æ¼çš„åŸå› **ï¼š

- å…¨å±€å˜é‡å¼•èµ·çš„å†…å­˜æ³„æ¼
- æ²¡æœ‰è¢«æ¸…é™¤çš„å®šæ—¶å™¨
- é—­åŒ…

**è§£å†³æ–¹æ³•**ï¼š

- å‡å°‘ä¸å¿…è¦çš„å…¨å±€å˜é‡
- å‡å°‘é—­åŒ…çš„ä½¿ç”¨ï¼ˆå› ä¸ºé—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼‰
- é¿å…æ­»å¾ªç¯çš„å‘ç”Ÿ

### å…¨å±€å˜é‡

å…¨å±€å˜é‡ä¸ä¼šè¢«å½“æˆåƒåœ¾å›æ”¶ï¼Œæˆ‘ä»¬åœ¨ç¼–ç ä¸­åº”è¯¥å°½é‡é¿å…å£°æ˜å…¨å±€å˜é‡ã€‚

```js
function foo() {
  // é»˜è®¤ç»‘å®š => window.bar = 10
  this.bar = 10;
  // æ²¡æœ‰æ˜¾å¼å£°æ˜å˜é‡ å®é™…æ˜¯å…¨å±€å˜é‡ => window.baz = 20
  baz = 20;
}

foo();
```

å½“æˆ‘ä»¬ä½¿ç”¨ [é»˜è®¤ç»‘å®š](../execution/this#é»˜è®¤ç»‘å®š)ï¼Œ`this` ä¼šæŒ‡å‘å…¨å±€å¯¹è±¡ã€‚

ğŸ”§ **è§£å†³æ–¹æ³•ï¼š** åœ¨å‡½æ•°å†…ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼æˆ–æ‰‹åŠ¨é‡Šæ”¾å…¨å±€å˜é‡çš„å†…å­˜ã€‚

### å®šæ—¶å™¨

å½“ä¸éœ€è¦ `setInterval` æˆ–è€… `setTimeout` æ—¶ï¼Œå®šæ—¶å™¨æ²¡æœ‰è¢«æ¸…é™¤ï¼Œå®šæ—¶å™¨çš„å›è°ƒå‡½æ•°ä»¥åŠå†…éƒ¨ä¾èµ–çš„å˜é‡éƒ½ä¸èƒ½è¢«å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚

```js
const someResource = getData();

// nodeã€someResource å­˜å‚¨äº†å¤§é‡æ•°æ® æ— æ³•å›æ”¶
const timerId = setInterval(function () {
  const node = document.getElementById('Node');

  if (node) {
    // å®šæ—¶å™¨ä¹Ÿæ²¡æœ‰æ¸…é™¤
    node.innerHTML = JSON.stringify(someResource);
  }
}, 1000);

clearInterval(timerId);
```

ğŸ”§ **è§£å†³æ–¹æ³•**ï¼šåœ¨å®šæ—¶å™¨å®Œæˆå·¥ä½œçš„æ—¶å€™ï¼Œæ‰‹åŠ¨æ¸…é™¤å®šæ—¶å™¨ã€‚

### é—­åŒ…

é—­åŒ…å¯ä»¥ç»´æŒå‡½æ•°å†…å±€éƒ¨å˜é‡ï¼Œä½¿å…¶å¾—ä¸åˆ°é‡Šæ”¾ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚

```js
function bindEvent() {
  const o = document.createElement('foo');
  const unused = function () {
    // é—­åŒ…å†…å¼•ç”¨å˜é‡ o å°†ä¸ä¼šé‡Šæ”¾
    console.log(o);
  };
}
```

ğŸ”§ **è§£å†³æ–¹æ³•**ï¼šæ‰‹åŠ¨è§£é™¤å¼•ç”¨ `o = null`

## å‚è€ƒèµ„æ–™

- [ğŸ“ å†…å­˜åŸºæœ¬çŸ¥è¯†](https://segmentfault.com/a/1190000006104910)
- [ğŸ“ JavaScript å†…å­˜æœºåˆ¶](https://juejin.im/post/5b10ba336fb9a01e66164346)
- [ğŸ“ An interesting kind of JavaScript memory leak](https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156)
- [ğŸ“ V8 å¼•æ“åƒåœ¾å›æ”¶ä¸å†…å­˜åˆ†é…](https://juejin.cn/post/6909239354418266119)
