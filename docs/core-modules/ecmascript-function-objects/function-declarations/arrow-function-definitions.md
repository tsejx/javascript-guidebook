---
nav:
  title: æ ¸å¿ƒæ¨¡å—
  order: 3
group:
  title: å‡½æ•°å£°æ˜Ž
  order: 6
title: ç®­å¤´å‡½æ•°
order: 2
---

# ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°è¡¨è¾¾å¼çš„è¯­æ³•æ¯”å‡½æ•°è¡¨è¾¾å¼æ›´çŸ­ï¼Œå¹¶ä¸”æ²¡æœ‰è‡ªå·±çš„ `this`ã€`arguments`ã€`super` å’Œ `new.target`ã€‚

ç®­å¤´å‡½æ•°è¡¨è¾¾å¼æ›´é€‚ç”¨äºŽé‚£äº›æœ¬æ¥éœ€è¦åŒ¿åå‡½æ•°çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¹¶ä¸”å®ƒä»¬ä¸èƒ½ç”¨ä½œæž„é€ å‡½æ•°ã€‚

## èµ‹å€¼å¼å†™æ³•

ç®­å¤´å‡½æ•°åªèƒ½ç”¨ **èµ‹å€¼å¼å†™æ³•**ï¼Œä¸èƒ½ç”¨å£°æ˜Žå¼å†™æ³•ã€‚

```js
const fn = () => {
  // do something
};
```

## ç®­å¤´å‡½æ•°å‚æ•°

### å•ä¸ªå‚æ•°

å½“åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼Œåœ†æ‹¬å·æ˜¯å¯é€‰çš„ï¼Œå¦‚æžœæ²¡æœ‰å‚æ•°æˆ–è€…å‚æ•°å¤šäºŽä¸€ä¸ªå°±éœ€è¦åŠ æ‹¬å·ã€‚

```js
const fn1 = (param1) => {
  // do something
};

const fn2 = () => {
  // do something
};

const fn3 = (param1, param2) => {
  // do something
};
```

### å‰©ä½™å‚æ•°

æ”¯æŒå‰©ä½™å‚æ•°å’Œé»˜è®¤å‚æ•°ã€‚

```js
const fn = (params1, params2, ...rest) => {
  // do something
};
```

ðŸŒ° **ä»£ç ç¤ºä¾‹**ï¼š

```js
const numbers = (...nums) => nums;

numbers(1, 2, 3, 4, 5);
// [1, 2, 3, 4, 5]

const headAndTail = (head, ...tail) => [head, tail];

headAndTail(1, 2, 3, 4, 5);
// [1, [2, 3, 4, 5]]
```

### é»˜è®¤å‚æ•°

```js
const fn = (params1 = default1, params2, ..., paramsN = defaultN) => {
  // do something
}
```

### è§£æž„èµ‹å€¼

åŒæ ·æ”¯æŒå‚æ•°åˆ—è¡¨è§£æž„

```js
const fn = ([a, b] = [1, 2], { x: c } = { x: a + b }) => a + b + c;

fn();
// 6
```

ðŸŒ° **ä»£ç ç¤ºä¾‹**

```js
const full = ({ first, last }) => firsr + '' + last;

// ç­‰åŒäºŽ
function full(person) {
  return person.first + '' + person.last;
}
```

## å‡½æ•°ä½“

### å•ä¸ªè¡¨è¾¾å¼

å¦‚æžœå‡½æ•°ä½“åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥ä¸åŠ èŠ±æ‹¬å·

```js
const fn = (param1, param2) => param1 + param2;
```

### è¿”å›žç¼ºçœå€¼

å¦‚æžœå‡½æ•°æ²¡æœ‰æ‹¬å·ï¼Œå¯ä»¥ä¸å†™ `return` ï¼Œç®­å¤´å‡½æ•°ä¼šå¸®ä½  `return`

```js
const fn = (param1, param2) => param1 + param2;

fn(1, 2);
```

### ç›´æŽ¥è¿”å›žå¯¹è±¡

åŠ æ‹¬å·çš„å‡½æ•°ä½“è¿”å›žå¯¹è±¡å­—é¢è¡¨è¾¾å¼

```js
const fn = (bar) => ({ foo: bar });
```

## åº”ç”¨åœºæ™¯

### å›žè°ƒå‡½æ•°

**æ•°ç»„æ–¹æ³• map å‡½æ•°ï¼š**

```js
// æ™®é€šå‡½æ•°å†™æ³•
const result = [1, 2, 3].map(function (x) {
  return x * x;
});

// ç®­å¤´å‡½æ•°å†™æ³•
const result = [1, 2, 3].map((x) => x * x);
```

**æ•°ç»„æ–¹æ³• sort å‡½æ•°ï¼š**

```js
// æ™®é€šå‡½æ•°å†™æ³•
const result = values.sort(function (a, b) {
  return a - b;
});

// ç®­å¤´å‡½æ•°å†™æ³•
const result = values.sort((a, b) => a - b);
```

## æ³¨æ„äº‹é¡¹

- å‡½æ•°ä½“å†…çš„ `this` å¯¹è±¡ï¼Œå°±æ˜¯ **å®šä¹‰æ—¶æ‰€åœ¨** çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡
- ä¸å¯ä»¥å½“ä½œæž„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨ `new` å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯
- ä¸å¯ä»¥ä½¿ç”¨ `arguments` å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æžœè¦ç”¨ï¼Œå¯ä»¥ç”¨ `rest` å‚æ•°ä»£æ›¿
- ä¸å¯ä»¥ä½¿ç”¨ `yield` å‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œ Generator å‡½æ•°

### ç®­å¤´å‡½æ•°ä¸­çš„ `this`

`this` å¯¹è±¡çš„æŒ‡å‘æ—¶å¯å˜çš„ï¼Œä½†æ˜¯åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œå®ƒæ˜¯**å›ºå®šçš„**ã€‚å› ä¸ºç®­å¤´å‡½æ•°å†…éƒ¨çš„ `this` æ˜¯ **è¯æ³•ä½œç”¨åŸŸ**ï¼Œç”±ä¸Šä¸‹æ–‡ç¡®å®šã€‚

```js
function foo() {
  setTimeout(() => {
    console.log(this.key);
  }, 100);
}

var key = 100;

foo.call({ key: 50 });
// 50
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`setTimeout` çš„å‚æ•°ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œè¿™ä¸ªç®­å¤´å‡½æ•°çš„å®šä¹‰ç”Ÿæ•ˆæ˜¯åœ¨ `foo` å‡½æ•°ç”Ÿæˆæ—¶ï¼Œè€Œå®ƒçš„çœŸæ­£æ‰§è¡Œè¦ç­‰åˆ° 100 æ¯«ç§’åŽã€‚å¦‚æžœæ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰§è¡Œæ—¶ `this` åº”è¯¥æŒ‡å‘å…¨å±€å¯¹è±¡ `window`ï¼Œè¿™æ—¶åº”è¯¥è¾“å‡º `100`ã€‚ä½†æ˜¯ï¼Œç®­å¤´å‡½æ•°å¯¼è‡´ `this` æ€»æ˜¯æŒ‡å‘å‡½æ•°å®šä¹‰ç”Ÿæ•ˆæ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼ˆæœ¬ä¾‹æ—¶ `{ key: 50 }`ï¼‰ï¼Œæ‰€ä»¥è¾“å‡ºçš„æ˜¯ `50`ã€‚

ç®­å¤´å‡½æ•°å¯ä»¥è®© `setTimeout` é‡Œé¢çš„ `this`ï¼Œç»‘å®šå®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯æŒ‡å‘è¿è¡Œæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚

ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚

```js
function Timer() {
  this.num1 = 0;
  this.num2 = 0;

  // ç®­å¤´å‡½æ•°
  setInterval(() => this.num1++, 1000);

  // æ™®é€šå‡½æ•°
  setInterval(function () {
    this.num2++;
  }, 1000);
}

const timer = new Timer();

setTimeout(() => console.log('num1', timer.num1), 3000);
setTimeout(() => console.log('num2', timer.num2), 3000);
// num1: 3
// num2: 0
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`Timer` å‡½æ•°å†…éƒ¨è®¾ç½®äº†ä¸¤ä¸ªå®šæ—¶å™¨ï¼Œåˆ†åˆ«ä½¿ç”¨äº†ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°ã€‚

å‰è€…çš„ `this` ç»‘å®š **å®šä¹‰æ—¶** æ‰€åœ¨çš„ä½œç”¨åŸŸï¼ˆå³ `Timer` å‡½æ•°ï¼‰ï¼ŒåŽè€…çš„ `this` æŒ‡å‘ **è¿è¡Œæ—¶** æ‰€åœ¨çš„ä½œç”¨åŸŸï¼ˆå³å…¨å±€å¯¹è±¡ï¼‰ã€‚æ‰€ä»¥ï¼Œ3000ms ä¹‹åŽï¼Œ `timer.num1` è¢«æ›´æ–°äº† 3 æ¬¡ï¼Œè€Œ `timer.num2` ä¸€æ¬¡éƒ½æ²¡æ›´æ–°ã€‚

ç®­å¤´å‡½æ•°å¯ä»¥è®© `this` æŒ‡å‘å›ºå®šåŒ–ï¼Œè¿™ç§ç‰¹å¾å¾ˆ **æœ‰åˆ©äºŽå°è£…å›žè°ƒå‡½æ•°**ã€‚

```js
const handler = {
  id: '123456',
  init: function () {
    document.addEventListener('click', (event) => this.doSomething(event.type), false);
  },
  doSomething: function (type) {
    console.log('Handling' + type + ' for ' + this.id);
  },
};
```

ä»¥ä¸Šçš„ä»£ç çš„ `init` æ–¹æ³•ä¸­ä½¿ç”¨äº†ç®­å¤´å‡½æ•°ï¼Œè¿™å¯¼è‡´ç®­å¤´å‡½æ•°é‡Œé¢çš„ `this` æ€»æ˜¯æŒ‡å‘ `handler` å¯¹è±¡ã€‚å¦åˆ™ï¼Œå›žè°ƒå‡½æ•°è¿è¡Œæ—¶ï¼Œ`this.doSomething` ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºæ­¤æ—¶ `this` æŒ‡å‘ `document` å¯¹è±¡ã€‚

âš ï¸ **æ³¨æ„**ï¼š`this` æŒ‡å‘çš„å›ºå®šåŒ–å¹¶ä¸æ˜¯å› ä¸ºç®­å¤´å‡½æ•°å†…éƒ¨æœ‰ç»‘å®š `this` çš„æœºåˆ¶ï¼Œå®žé™…åŽŸå› æ—¶ç®­å¤´å‡½æ•°æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œå¯¼è‡´å†…éƒ¨çš„ `this` å°±æ˜¯å¤–å±‚ä»£ç å—çš„ `this`ã€‚æ­£æ˜¯å› ä¸ºå®ƒæ²¡æœ‰ `this`ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ä½œæž„é€ å‡½æ•°ã€‚

ç®­å¤´å‡½æ•°è½¬æˆ ES5 çš„ä»£ç å¦‚ä¸‹ã€‚

```js
// ES6
function foo() {
  setTimeout(() => {
    console.log('id:', this.id);
  }, 100);
}

// ES5
function foo() {
  var _this = this;

  setTimeout(function () {
    console.log('id:', _this.id);
  }, 100);
}
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè½¬æ¢åŽçš„ ES5 ç‰ˆæœ¬æ¸…æ¥šåœ°è¯´æ˜Žäº†ç®­å¤´å‡½æ•°é‡Œé¢æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œè€Œæ˜¯å¼•ç”¨å¤–å±‚çš„ `this`ã€‚

```js
// è¯·é—®ä¸‹é¢çš„ä»£ç ä¹‹ä¸­æœ‰å‡ ä¸ªthis?
function foo() {
  return () => {
    return () => {
      return () => {
        console.log('id:', this.id);
      };
    };
  };
}

var fn = foo.call({ id: 1 });

var res1 = fn.call({ id: 2 })()();
// id: 1
var res2 = fn().call({ id: 3 })();
// id: 1
var res3 = fn()().call({ id: 4 });
// id: 1
```

ä¸Šé¢çš„ä»£ç ä¸­åªæœ‰ä¸€ä¸ª `this`ï¼Œå°±æ˜¯å‡½æ•° `foo` çš„ `this`ï¼Œæ‰€ä»¥ `res1`ã€`res2`ã€`res3` éƒ½è¾“å‡ºåŒæ ·çš„ç»“æžœã€‚å› ä¸ºæ‰€æœ‰çš„å†…å±‚å‡½æ•°éƒ½æ˜¯ç®­å¤´å‡½æ•°ï¼Œéƒ½æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œå®ƒä»¬çš„ `this` å…¶å®žéƒ½æ˜¯æœ€å¤–å±‚ `foo` å‡½æ•°çš„ `this`ã€‚

é™¤äº† `this` å¤–ï¼Œä»¥ä¸‹ä¸‰ä¸ªå˜é‡åœ¨ç®­å¤´å‡½æ•°ä¹‹ä¸­ä¹Ÿæ˜¯ä¸å­˜åœ¨çš„ï¼ŒæŒ‡å‘å¤–å±‚å‡½æ•°çš„å¯¹åº”å˜é‡ï¼š`arguments`ã€`super`ã€`new.target`ã€‚

```js
function foo() {
  setTimeout(() => {
    console.log('args:', arguments);
  }, 100);
}

foo(2, 4, 6, 8);
// args: [2, 4, 6, 8]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç®­å¤´å‡½æ•°å†…éƒ¨çš„å˜é‡ `arguments` ï¼Œå…¶å®žæ˜¯å‡½æ•° `foo` çš„ `arguments` å˜é‡ã€‚

å¦å¤–ï¼Œç”±äºŽç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„`this`ï¼Œæ‰€ä»¥å½“ç„¶ä¹Ÿå°±ä¸èƒ½ç”¨`call()`ã€`apply()`ã€`bind()`è¿™äº›æ–¹æ³•åŽ»æ”¹å˜`this`çš„æŒ‡å‘ã€‚

```js
(function () {
  return [(() => this.x).bind({ x: 'inner' })()];
}.call({ x: 'outer' }));
// ['outer']
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„`this`ï¼Œæ‰€ä»¥`bind`æ–¹æ³•æ— æ•ˆï¼Œå†…éƒ¨çš„`this`æŒ‡å‘å¤–éƒ¨çš„`this`ã€‚

### åµŒå¥—çš„ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°å†…éƒ¨ï¼Œè¿˜å¯ä»¥å†ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª ES5 è¯­æ³•çš„å¤šé‡åµŒå¥—å‡½æ•°ã€‚

```js
function insert(value) {
  return {
    into: function (array) {
      return {
        after: function (afterValue) {
          array.splice(array.indexOf(afterValue) + 1, 0, value);
          return array;
        },
      };
    },
  };
}

insert(2).into([1, 3]).after(1); // [1, 2, 3]
```

ä¸Šé¢è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°æ”¹å†™ã€‚

```js
let insert = (value) => ({
  into: (array) => ({
    after: (afterValue) => {
      array.splice(array.indexOf(afterValue) + 1, 0, value);
      return array;
    },
  }),
});

insert(2).into([1, 3]).after(1); // [1, 2, 3]
```

ä¸‹é¢æ˜¯ä¸€ä¸ªéƒ¨ç½²ç®¡é“æœºåˆ¶ï¼ˆpipelineï¼‰çš„ä¾‹å­ï¼Œå³å‰ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºæ˜¯åŽä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚

```js
const pipeline = (...focus) => (val) => focus.reduce((a, b) => b(a), val);

const plus1 = (a) => a + 1;
const mult2 = (a) => a * 2;
const addThenMult = pipeline(plus1, mult2);

addTheMult(5);
// 12
```

å¦‚æžœè§‰å¾—ä¸Šé¢çš„å¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„å†™æ³•ã€‚

```js
const plus1 = (a) => a + 1;
const mult2 = (a) => a * 2;

mult2(plus1(5));
// 12
```
