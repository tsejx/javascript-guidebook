---
nav:
  title: è®¡ç®—æœºç½‘ç»œ
  order: 8
group:
  title: HTTP
  order: 3
title: HTTP CORS è·¨åŸŸèµ„æºå…±äº«
order: 6
---

# HTTP CORS è·¨åŸŸèµ„æºå…±äº«

è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼šCross-Origin Resource Sharingï¼‰æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ Â HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ï¼Œè®©è¿è¡Œåœ¨ç›¸åŒåŸŸï¼ˆOriginï¼‰ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ªä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºï¼ˆä¹Ÿå³æ˜¯ [åŒæºç­–ç•¥](../frontend-security/same-origin-policy.md) çš„ HTTP è§£å†³æ–¹æ¡ˆï¼‰ã€‚å½“ä¸€ä¸ªèµ„æºä»ä¸è¯¥èµ„æºæœ¬èº«æ‰€åœ¨çš„æœåŠ¡å™¨**ä¸åŒçš„åŸŸã€åè®®æˆ–ç«¯å£**è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œèµ„æºä¼šå‘èµ·ä¸€ä¸ª**è·¨åŸŸ HTTP è¯·æ±‚**ã€‚

CORS æœºåˆ¶æ˜¯ä¸ºäº†åœ¨è®¤å¯ç”¨æˆ·å‘èµ·çš„è¯·æ±‚çš„åŒæ—¶ï¼Œé˜»æ­¢æ¶æ„æ³¨å…¥è„šæœ¬ï¼›å¹¶åœ¨ä»¥ä¸‹æƒ…å†µå‘èµ·çš„ HTTP è¯·æ±‚æ—¶è§¦å‘ï¼š

- ä¸åŒçš„åŸŸï¼šæ¯”å¦‚ä» `example.com` è°ƒç”¨ `api.com`
- ä¸åŒçš„å­åŸŸï¼šæ¯”å¦‚ä» `example.com` è°ƒç”¨ `api.example.com`
- ä¸åŒçš„ç«¯å£ï¼šæ¯”å¦‚ä» `example.com` è°ƒç”¨ `example.com:3001`
- ä¸åŒçš„åè®®ï¼šæ¯”å¦‚ä» `https://example.com` è°ƒç”¨ `http://example.com`

## å®ç°æ¡ä»¶

æµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚

### ç®€å•è¯·æ±‚

åªè¦æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ï¼š

**æƒ…å†µä¸€ï¼š** è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€

- HEAD
- GET
- POST

**æƒ…å†µäºŒï¼š** äººä¸ºè®¾ç½®ä¸€ä¸‹é›†åˆå¤–çš„è¯·æ±‚å¤´

- Accept
- Accept-Language
- Content-Language
- Content-Typeï¼ˆä¾‹å¦‚ `application/json` ä¸ºéç®€å•è¯·æ±‚ï¼‰
  - `text/plain`
  - `multipart/form-data`
  - `application/x-www-form-urlencoded`
- DPR
- Downlink
- Save-Data
- Viewport-Width
- Width
- Last-Event-ID

**æƒ…å†µä¸‰ï¼š** è¯·æ±‚ä¸­çš„ä»»æ„ XMLHttpRequestUpload å¯¹è±¡å‡æ²¡æœ‰æ³¨å†Œä»»ä½•äº‹ä»¶ç›‘å¬å™¨ï¼›XMLHttpRequestUpload å¯¹è±¡å¯ä»¥ä½¿ç”¨ `XMLHttpRequest.upload` å±æ€§è®¿é—®ã€‚

**æƒ…å†µå››ï¼š** è¯·æ±‚ä¸­æ²¡æœ‰ ReadableStream å¯¹è±¡ã€‚

### éç®€å•è¯·æ±‚

é™¤äº†ç®€å•è¯·æ±‚è¿™äº›é™åˆ¶å¤–çš„éƒ½ä¸ºéç®€å•è¯·æ±‚ã€‚

éç®€å•è¯·æ±‚éœ€è¦æ»¡è¶³ä½¿ç”¨ä»¥ä¸‹ä»»æ„æ–¹æ³•çš„æ¡ä»¶ï¼š

- PUT
- DELETE
- CONNECT
- OPTIONS
- TRACE
- PATCH

æœ€å¸¸ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºç®€å•å’Œéç®€å•è¯·æ±‚çš„æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡è¯·æ±‚æ–¹æ³•å’Œ `Content-Type` çš„å€¼ã€‚

## é¢„è¯·æ±‚ Preflight

é¢„è¯·æ±‚æ˜¯ OPTIONS è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ·»åŠ  `Access-Control-Allow-Headers` å’Œ `Access-Control-Allow-Methods`ã€‚

éœ€è¦æœåŠ¡ç«¯è¿”å›çš„å“åº”å¤´ `Access-Control-Allow-Headers`ã€`Access-Control-Allow-Methods` å’Œ `Access-Control-Allow-Origin`ã€‚

é™¤äº† `Access-Control-Allow-Origin` æ˜¯å¿…é¡»çš„ä¹‹å¤–ï¼Œå…¶ä»–ä¸¤ç§åªæœ‰åœ¨ä¸ç¬¦åˆç®€å•è¯·æ±‚éœ€è¦çš„æ—¶å€™æœåŠ¡å™¨æ‰éœ€è¦æ·»åŠ ï¼Œæ¯”å¦‚åœ¨ç®€å•è¯·æ±‚çš„åŸºç¡€ä¸Šè‡ªå®šä¹‰äº†ä¸€ä¸ªè¯·æ±‚å¤´ `X-xx-name: chris`ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åªéœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ  `Access-Control-Allow-Headers`ã€‚æ¯ç§å“åº”å¤´éƒ½å¯ä»¥ä½¿ç”¨ `*` é€šé…ç¬¦æ¥è¡¨ç¤ºæ‰€æœ‰ã€‚

## æ­£å¸¸è¯·æ±‚

é¢„è¯·æ±‚å®Œä¹‹åå°±å¯ä»¥å‘é€æ­£å¸¸è¯·æ±‚äº†ï¼Œæ­£å¸¸è¯·æ±‚çš„æ­¥éª¤ä¸ç®€å•è¯·æ±‚ä¸€è‡´ï¼Œä¹Ÿéœ€è¦æ·»åŠ  `Access-Control-Allow-Origin` å“åº”å¤´ã€‚

### å‡å°‘é¢„è¯·æ±‚æ¬¡æ•°

å¯ä»¥é€šè¿‡è®¾ç½® `Access-Control-Max-Aage` æ¥å‡å°‘é¢„è¯·æ±‚çš„æ¬¡æ•°ï¼Œéœ€è¦åŒ…å«åœ¨é¢„è¯·æ±‚çš„å“åº”å¤´ä¸­ï¼ŒæŒ‡å®šåœ¨è¯¥æ—¶é—´å†…é¢„è¯·æ±‚éªŒè¯æœ‰æ•ˆï¼Œä¸å¿…æ¯æ¬¡éƒ½è¿›è¡Œé¢„è¯·æ±‚ï¼Œå®ƒçš„å•ä½æ˜¯ `s`ã€‚å¦‚ `Access-Control-Max-Age: 1728000`ï¼Œå³æœ‰æ•ˆæœŸä¸º 20 å¤©ã€‚

## ä½¿ç”¨åœºæ™¯

è·¨åŸŸèµ„æºå…±äº«æ ‡å‡†ï¼ˆCross-Origin Sharing Standardï¼‰å…è®¸åœ¨ä¸‹åˆ—åœºæ™¯ä¸­ä½¿ç”¨è·¨åŸŸ HTTP è¯·æ±‚ï¼š

- å‰æ–‡æåˆ°çš„ç”± XMLHttpRequest æˆ– Fetch å‘èµ·çš„è·¨åŸŸ HTTP è¯·æ±‚
- Web å­—ä½“ï¼ˆCSS é€šè¿‡ `@font-face` ä½¿ç”¨è·¨åŸŸå­—ä½“èµ„æºï¼‰
- WebGL è´´å›¾
- ä½¿ç”¨ `drawImage` å°† `Images/viedo` ç”»é¢ç»˜åˆ¶åˆ° Canvas
- æ ·å¼è¡¨ï¼ˆä½¿ç”¨ CSSOM ï¼‰

> âš ï¸ æ³¨æ„ï¼šHTML ä¸­ `<link>`ã€`<script>`ã€`<img>` ç­‰æ ‡ç­¾è‡ªå¸¦è¿æ¥å±æ€§è¿›è¡Œ HTTP è¯·æ±‚æ˜¯èƒ½å¤Ÿæ— è§†åŒæºç­–ç•¥çš„ã€‚

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ“– MDN HTTP Access control CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS)
- [ğŸ“ ç†è§£ CORS](https://juejin.im/post/5a97b5a3f265da23766ab19a)
- [ğŸ“ é˜®ä¸€å³° è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£](http://www.ruanyifeng.com/blog/2016/04/cors.html)
- [ğŸ“ ç”±åŒæºç­–ç•¥åˆ°å‰ç«¯è·¨åŸŸ](https://juejin.im/post/58f816198d6d81005874fd97)
