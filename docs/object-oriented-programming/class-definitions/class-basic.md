---
nav:
  title: OOP
  order: 4
group:
  title: ç±»
  order: 5
title: ç±»çš„åŸºæœ¬è¯­æ³•
order: 1
---

# ç±»çš„åŸºæœ¬è¯­æ³•

ECMAScript 6 ä¸­çš„ Classï¼ˆç±»ï¼‰æ¦‚å¿µï¼Œå®é™…ä¸Šå¯ä»¥æŠŠå®ƒçœ‹ä½œ ECMAScript 5 å¯¹è±¡åŸå‹å†™æ³•çš„è¯­æ³•ç³–ã€‚

**ES5ï¼š**

```js
function Point(x, y){
  this.x = x
  this.y = y
}

Point.prototype.toString = function() {
  return '(' +  this.x + ',' + this.y + ')'
}

var p = new Point(1, 2)
```

**ES6ï¼š**

```js
class Point {
  constructor(x, y){
    this.x = x
    this.y = y
  }
  toString(){
    return '(' +  this.x + ',' + this.y + ')'
  }
}
```

## ç±»å£°æ˜

ä¸ ES5 ç›¸åŒçš„æ˜¯ï¼Œç±»ä¹Ÿæ˜¯é€šè¿‡ `new` å…³é”®å­—åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚

ä¸ ES5 ä¸åŒçš„æ˜¯ï¼Œåœ¨ ES6 ä¸­ï¼Œæˆ‘ä»¬å°†åŸå‹çš„å®ç°å†™åœ¨äº†ç±»ä¸­ï¼Œä½†æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯éœ€è¦æ–°å»ºä¸€ä¸ªç±»åï¼Œç„¶åå®ç°æ„é€ å‡½æ•°ï¼Œå†å®ç°åŸå‹æ–¹æ³•ã€‚

```js
class Foo(){
  // æ„é€ å‡½æ•°
  constructor(name = 'Uzi'){
    this.name = name
  }
  // å®šä¹‰ä¸€ä¸ªæ–¹æ³•å¹¶ä¸”èµ‹å€¼ç»™æ„é€ å‡½æ•°çš„åŸå‹
  sayName(){
    console.log(this.name)
  }
}

const foo = new Foo()
foo.sayName()
// 'Uzi'
```

ç±»å£°æ˜å’Œå‡½æ•°å£°æ˜çš„åŒºåˆ«å’Œç‰¹ç‚¹ï¼š

1. å‡½æ•°å£°æ˜å¯ä»¥è¢«æå‡ï¼ˆHoistï¼‰ï¼Œç±»å£°æ˜ä¸èƒ½æå‡ï¼ˆä¸ `let` å£°æ˜ç±»ä¼¼ï¼‰
2. ç±»å£°æ˜ä¸­çš„ä»£ç è‡ªåŠ¨å¼ºè¡Œè¿è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹
3. åªèƒ½é€šè¿‡ `new` å…³é”®å­—æ¥å£°æ˜ç±»ï¼Œå£°æ˜ç±»ä¼šè°ƒç”¨ç±»çš„æ„é€ å‡½æ•°
4. æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª `[[construct]]` çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯æ„é€ å‡½æ•°
5. ç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½å®šä¹‰åœ¨ç±»çš„ `prototype` å±æ€§ä¸Š
6. ç±»ä¸­çš„æ–¹æ³•æ— éœ€æ·»åŠ  `function` å…³é”®å­—ï¼Œåªéœ€ç›´æ¥æ·»åŠ åˆ°ç±»ä¸­
7. æ–¹æ³•é—´ä¸éœ€è¦æ·»åŠ é€—å·ï¼ˆ`,`ï¼‰ï¼ŒåŠ äº†ä¼šæŠ¥é”™
8. ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ä¸å¯æšä¸¾çš„ï¼ˆnon-enumerableï¼‰ï¼Œè€Œè‡ªå®šä¹‰ç±»å‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ `Object.definedProperty()` æ‰‹å·¥æŒ‡å®šä¸å¯æšä¸¾å±æ€§
9. åœ¨ç±»çš„å®ä¾‹ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œå®è´¨ä¸Šå°±æ˜¯è°ƒç”¨åŸå‹ä¸Šçš„æ–¹æ³•
10. ä¸èƒ½åœ¨ç±»ä¸­ä¿®æ”¹ç±»å

## æ„é€ å‡½æ•°

æ„é€ å‡½æ•°ï¼ˆ`constructor` æ–¹æ³•ï¼‰æ˜¯ç±»çš„é»˜è®¤æ–¹æ³•ï¼Œé€šè¿‡ `new` å…³é”®å­—ç”Ÿæˆå¯¹è±¡å®ä¾‹æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚è‹¥æ²¡æœ‰æ˜¾å¼å®šä¹‰ï¼Œä¸€ä¸ªç©ºçš„æ„é€ å‡½æ•°ä¼šè¢«é»˜è®¤æ·»åŠ ã€‚

ğŸ“Œ ç±»å¿…é¡»ä½¿ç”¨ `new` å…³é”®å­—è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å®ƒè·Ÿæ™®é€šæ„é€ å‡½æ•°çš„ä¸€ä¸ªä¸»è¦åŒºåˆ«ï¼Œåè€…ä¸ç”¨ `new` å…³é”®å­—ä¹Ÿèƒ½æ‰§è¡Œã€‚

## å®ä¾‹å¯¹è±¡

ä¸ ES5 ä¸€æ ·ï¼Œå®ä¾‹çš„å±æ€§é™¤éæ˜¾å¼å®šä¹‰åœ¨å…¶æœ¬èº«ï¼ˆå³å®šä¹‰åœ¨ `this` å¯¹è±¡ä¸Šï¼‰ï¼Œå¦åˆ™éƒ½æ˜¯å®šä¹‰åœ¨ **åŸå‹** ä¸Šï¼ˆå³å®šä¹‰åœ¨ `class` ä¸Šï¼‰ã€‚

```js
class Point{
  constructor(x, y){
    this.x = x
    this.y = y
  }
  toString(){
    return `(${this.x}, ${this.y})`
  }
}

const point = new Point(2, 3)

point.toString()
// (2, 3)

point.hasOwnProperty('x')
// true
point.hasOwnProperty('y')
// true
point.hasOwnProperty('toString')
// false
point.__proto__.hasOwnProperty('toString')
// true
```

* å˜é‡ `x` å’Œ `y` éƒ½æ˜¯å®ä¾‹å¯¹è±¡ `point` è‡ªèº«çš„å±æ€§ï¼ˆå› ä¸ºå®šä¹‰åœ¨ `this` å˜é‡ä¸Šï¼‰ï¼Œæ‰€ä»¥ `hasOwnProperty` è¿”å› `true`
* è€Œ `toString` æ˜¯åŸå‹å¯¹è±¡çš„å±æ€§ï¼ˆå› ä¸ºå®šä¹‰åœ¨ `Point` ç±»ä¸Šï¼‰ï¼Œæ‰€ä»¥ `hasOwnProperty` æ–¹æ³•è¿”å› `false`

ä¸ ES5 ä¸€æ ·ï¼Œç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä¸ªåŸå‹å¯¹è±¡ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¯ä»¥é€šè¿‡å®ä¾‹çš„ `__proto__` å±æ€§ä¸ºç±»æ·»åŠ æ–¹æ³•ã€‚

>âš ï¸ `__proto__`Â å¹¶ä¸æ˜¯è¯­è¨€æœ¬èº«çš„ç‰¹æ€§ï¼Œè¿™æ˜¯å„å¤§å‚å•†å…·ä½“å®ç°æ—¶æ·»åŠ çš„ç§æœ‰å±æ€§ï¼Œè™½ç„¶ç›®å‰å¾ˆå¤šç°ä»£æµè§ˆå™¨çš„ JS å¼•æ“ä¸­éƒ½æä¾›äº†è¿™ä¸ªç§æœ‰å±æ€§ï¼Œä½†ä¾æ—§ä¸å»ºè®®åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è¯¥å±æ€§ï¼Œé¿å…å¯¹ç¯å¢ƒäº§ç”Ÿä¾èµ–ã€‚ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â `Object.getPrototypeOf`Â æ–¹æ³•æ¥è·å–å®ä¾‹å¯¹è±¡çš„åŸå‹ï¼Œç„¶åå†æ¥ä¸ºåŸå‹æ·»åŠ æ–¹æ³•/å±æ€§ã€‚

## è®¿é—®å™¨å±æ€§

ä¸ ES5 ä¸€æ ·ï¼Œåœ¨ç±»çš„å†…éƒ¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `get` å’Œ `set` å…³é”®å­—ï¼Œå¯¹æŸä¸ªå±æ€§è®¾ç½® **å­˜å€¼å‡½æ•°** å’Œ **å–å€¼å‡½æ•°**ï¼Œæ‹¦æˆªè¯¥å±æ€§çš„å­˜å–è¡Œä¸ºã€‚

å°½ç®¡åº”è¯¥åœ¨ç±»çš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºè‡ªå·±çš„å±æ€§ï¼Œä½†æ˜¯ç±»ä¹Ÿæ”¯æŒç›´æ¥åœ¨åŸå‹ä¸Šå®šä¹‰è®¿é—®å™¨å±æ€§ã€‚

```js
class Student () {
  constructor () {
    // ...
  }
  get run () {
    return 'get'
  }
  set run (value) {
    console.log(`set:${value}`)
  }
}

let inst = new Student()

Student.run = 'abc'
// set:abc

Student.run
// get
```

## å±æ€§è¡¨è¾¾å¼

ç±»çš„å±æ€§åï¼Œå¯ä»¥é‡‡ç”¨è¡¨è¾¾å¼ã€‚

```js
const methodName = 'getArea'

class Square(){
  constructor(length){
    // ...
  }
  [methodName](){
    // ...
  }
}
```

## ç±»çš„è¡¨è¾¾å¼

ç±»æœ‰ä¸¤ç§è¡¨ç°å½¢å¼ï¼šå£°æ˜å¼å’Œè¡¨è¾¾å¼ã€‚

```js
// å£°æ˜å¼
class Foo = {
  constructor () {}
}

// åŒ¿åè¡¨è¾¾å¼
const Bar = class {
  constructor () {}
}

// è¡¨è¾¾å¼
// è¿™ä¸ªç±»çš„åç§°ä¸º Baz2 è€Œä¸æ˜¯ Baz1
// Baz1 åªæœ‰åœ¨ç±»å†…éƒ¨ä»£ç å¯ç”¨ æŒ‡ä»£å½“å‰ç±»
const Baz2 = class Baz1 {
  constructor () {}
  getClassName () {
    return Baz1.name
  }
}
```

âš ï¸ **æ³¨æ„ç‚¹ï¼š**

* å…¨å±€ä¸¥æ ¼æ¨¡å¼
* ä¸å­˜åœ¨ç±»å£°æ˜æå‡
* `name` å±æ€§ï¼šæ€»æ˜¯è¿”å›ç´§è·Ÿ `class` å…³é”®å­—åçš„ç±»å
* Generator æ–¹æ³•
* `this` çš„æŒ‡å‘ é»˜è®¤æŒ‡å‘ç±»çš„å®ä¾‹

## ç”Ÿæˆå™¨æ–¹æ³•

å¦‚æœæŸä¸ªæ–¹æ³•ä¹‹å‰åŠ ä¸Šæ˜Ÿå·ï¼ˆ`*`ï¼‰ï¼Œå°±è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨æ–¹æ³•ï¼ˆGenerator å‡½æ•°ï¼‰ã€‚

```js
class Foo {
  constructor (...args) {
    this.args = args
  }
  * [Symbol.iterator] () {
    for (let arg of this.args) {
      yield arg
    }
  }
}

for (let x of new Foo('hello', 'world')) {
  console.log(x)
}
// hello
// world
```

## `this` çš„æŒ‡å‘

ç±»çš„æ–¹æ³•å†…éƒ¨å¦‚æœå«æœ‰ `this`ï¼Œå®ƒé»˜è®¤æŒ‡å‘ç±»çš„å®ä¾‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†ç±»æ–¹æ³•å†…éƒ¨çš„æ–¹æ³•æå–å‡ºæ¥å•ç‹¬ä½¿ç”¨ï¼Œ`this` ä¼šæŒ‡å‘è¯¥æ–¹æ³•è¿è¡Œæ—¶æ‰€åœ¨çš„ç¯å¢ƒï¼Œå› ä¸ºæ‰¾ä¸åˆ°ç›¸å¯¹åº”çš„æ–¹æ³•è€Œå¯¼è‡´æŠ¥é”™ã€‚

å› æ­¤ï¼Œéœ€è¦ **åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®š `this`** ï¼Œè¿™æ ·å°±ä¸ä¼šæ‰¾ä¸åˆ°ç›¸å¯¹åº”çš„æ–¹æ³•ã€‚

```js
class Student {
  constructor () {
    this.sayName = this.sayName.bind(this)
  }
}
```

å¦ä¸€ç§è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨**ç®­å¤´å‡½æ•°**ã€‚

```js
class Car {
  constructor () {
    this.sayName = (name = 'BOT') => {
      this.sayName(`My name is ${name}`)
    }
  }
}
```

è¿˜æœ‰ä¸€ç§è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ `Proxy` ï¼Œè·å–æ–¹æ³•çš„æ—¶å€™ï¼Œè‡ªåŠ¨ç»‘å®š `this`ã€‚è¯¦æƒ…[ç‚¹å‡»è¿™é‡Œ](http://es6.ruanyifeng.com/#docs/class#this-%E7%9A%84%E6%8C%87%E5%90%91)ã€‚

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ“ ECMAScrept 6 å…¥é—¨ï¼šClass çš„åŸºæœ¬è¯­æ³•](http://es6.ruanyifeng.com/#docs/class)
- [ğŸ“ ES6 JavaScriptä¸­çš„ç±» class](https://juejin.im/entry/59bbb3b65188256c4b723bdb)