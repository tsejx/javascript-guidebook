(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{617:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"地理访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#地理访问"}},[t._v("#")]),t._v(" 地理访问")]),t._v(" "),a("p",[t._v("根据用户的地理位置提供相关地区服务，已经是非常普遍的一项功能，例如本地生活服务类网站、外卖网站等。HTML5 新功能中提供了获取用户位置的能力。")]),t._v(" "),a("p",[t._v("各主要浏览器对 HTML5 Geolocation API 的支持情况：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("浏览器")]),t._v(" "),a("th",[t._v("版本")]),t._v(" "),a("th",[t._v("只支持HTTPS版本")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("IE")]),t._v(" "),a("td",[t._v("9+")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td",[t._v("Edge")]),t._v(" "),a("td",[t._v("12+")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td",[t._v("Firefox")]),t._v(" "),a("td",[t._v("3.5+")]),t._v(" "),a("td",[t._v("-")])]),t._v(" "),a("tr",[a("td",[t._v("Chrome")]),t._v(" "),a("td",[t._v("5+")]),t._v(" "),a("td",[t._v("50+")])]),t._v(" "),a("tr",[a("td",[t._v("Safari")]),t._v(" "),a("td",[t._v("5+")]),t._v(" "),a("td",[t._v("39+")])]),t._v(" "),a("tr",[a("td",[t._v("iOS Safari")]),t._v(" "),a("td",[t._v("3.2+")]),t._v(" "),a("td",[t._v("10.2+")])]),t._v(" "),a("tr",[a("td",[t._v("Android Browser")]),t._v(" "),a("td",[t._v("2.1+")]),t._v(" "),a("td",[t._v("56+")])]),t._v(" "),a("tr",[a("td",[t._v("Chrome for Android")]),t._v(" "),a("td",[t._v("57+")]),t._v(" "),a("td",[t._v("57+")])]),t._v(" "),a("tr",[a("td",[t._v("UC Browser for Android")]),t._v(" "),a("td",[t._v("11.4+")]),t._v(" "),a("td",[t._v("-")])])])]),t._v(" "),a("p",[t._v("注意：处于安全考虑，部分最新的浏览器的浏览器只允许通过 HTTPS 协议使用 Geolocation API。在 HTTPS 协议下使用 Geolocation API，浏览器会抛出异常。在开发阶段，127.0.0.1 和 localhost 等本地域在两种协议下均可以使用。")]),t._v(" "),a("p",[t._v("Geolocation API 通过 "),a("code",[t._v("navigator.geolocation")]),t._v(" 全局对象进行访问。初次访问时，浏览器会询问用户是否允许共享位置，若用户选择允许则程序获得使用 Geolocation API 权限。判断浏览器是否存在 "),a("code",[t._v("navigator.geolocation")]),t._v(" 对象来得知。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("geolocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取地理位置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'您的浏览器不支持Geolocation!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("获取用户的当前位置，可以调用 "),a("code",[t._v("navigator.geolocation")]),t._v(" 的 "),a("code",[t._v("getCurrentPosition")]),t._v(" 方法。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("geolocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tnavigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("geolocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCurrentPosition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("position")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'获取位置成功:'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" position"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("coords"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("positionError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'获取位置失败:'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" positionError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        positionError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \tenableHightAccuracy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n         \ttimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n         \tmaximumAge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'您的浏览器不支持Geolocation!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("成功获取位置后，会调用回调函数 "),a("code",[t._v("success")]),t._v("。返回参数 "),a("code",[t._v("position")]),t._v(" 对象包含获取位置时的时间戳 "),a("code",[t._v("timestamp")]),t._v(" 和坐标信息 "),a("code",[t._v("coords")]),t._v("。"),a("code",[t._v("coords")]),t._v(" 对象包含了很多有用的位置数据信息，列举几个常用的属性：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("latitude")]),t._v(" "),a("td",[t._v("坐标纬度")])]),t._v(" "),a("tr",[a("td",[t._v("longitude")]),t._v(" "),a("td",[t._v("坐标经度")])]),t._v(" "),a("tr",[a("td",[t._v("accuracy")]),t._v(" "),a("td",[t._v("坐标精度，单位为米")])])])]),t._v(" "),a("p",[t._v("当获取位置失败时，会调用回调函数 "),a("code",[t._v("error")]),t._v("。返回的参数 "),a("code",[t._v("positionError")]),t._v(" 的 "),a("code",[t._v("message")]),t._v(" 属性包含了相关的错误信息描述，"),a("code",[t._v("positionError.code")]),t._v(" 标识错误的原因，"),a("code",[t._v("positionError.code")]),t._v(" 的值有以下几种。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("UNKNOWN_ERROR(0)")])]),t._v(" "),a("td",[t._v("其他错误")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("PERMISSION_DENIED(1)")])]),t._v(" "),a("td",[t._v("用户拒绝分享位置信息")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("POSITION_UNAVAILABLE(3)")])]),t._v(" "),a("td",[t._v("获取用户位置信息失败")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("TIMEOUT(3)")])]),t._v(" "),a("td",[t._v("获取用户位置信息超时")])])])]),t._v(" "),a("p",[a("code",[t._v("gerCurrentPosition")]),t._v(" 方法的参数 "),a("code",[t._v("options")]),t._v(" 可以设置以下内容。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("enableHighAccuray")]),t._v(" "),a("td",[t._v("布尔值，是否获取高精度的位置信息，如果开启，可能会增加响应时间，默认值为 "),a("code",[t._v("false")])])]),t._v(" "),a("tr",[a("td",[t._v("timeout")]),t._v(" "),a("td",[t._v("定位超时时间，单位毫秒，如到达时间时没有取得用户位置信息，则触发失败回调函数，默认值为0，表示无限大")])]),t._v(" "),a("tr",[a("td",[t._v("maximumAge")]),t._v(" "),a("td",[t._v("用户位置信息缓存的最大时间（单位为毫秒），默认值为 0")])])])]),t._v(" "),a("p",[t._v("当用户位置变化时，还可以通过 "),a("code",[t._v("watchPosition")]),t._v(" 方法监听用户的位置信息，"),a("code",[t._v("watchPosition")]),t._v(" 的参数和 "),a("code",[t._v("getCurrentPosition")]),t._v(" 相同。函数执行后返回一个唯一标识，可以使用 "),a("code",[t._v("clearWatch")]),t._v(" 方法来取消监听。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" watchId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("geolocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("watchPosition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("success"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nnavigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("geolocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearWatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("watchId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=o.exports}}]);